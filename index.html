<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Simulateur UV â€“ Examen</title>

<link rel="stylesheet" href="banner.css">
<link rel="stylesheet" href="style.css">
<link rel="manifest" href="manifest.json">
<link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300..700&display=swap" rel="stylesheet">

<style>
.grid {
  display: grid !important;
  grid-template-columns: 1fr !important;
  gap: 20px !important;
  width: 100%;
}
</style>
</head>

<body data-subtitle="ğŸŒ¸ Exerciseur ğŸŒ¸">

<div id="bannerContainer"></div>

<div class="main-wrapper">
  <div class="card-kawaii">

    <!-- =========================
        Techniques de taÃ¯-jitsu
         ========================= -->

<div class="card-kawaii wheel-card">
  <h2 class="module-title">ğŸ¡ Roue des Assauts</h2>

  <div class="wheel-wrapper">
    <canvas id="wheel" width="320" height="320"></canvas>
    <div class="wheel-pointer">â–²</div>
  </div>

  <div class="controls-row">
    <button id="spinBtn" class="btn-kawaii start">Faire tourner ğŸ¯</button>
    <span id="soundToggle" class="beep-icon">ğŸ”Š</span>
  </div>

  <details>
    <summary>âš™ï¸ Filtres</summary>
    <div class="inner">
      <label><input type="checkbox" class="filter" value="Arme" checked> Armes</label><br>
      <label><input type="checkbox" class="filter" value="Atemi" checked> Atemi</label><br>
      <label><input type="checkbox" class="filter" value="Saisie" checked> Saisies</label><br>
      <label><input type="checkbox" class="filter" value="Encerclement" checked> Encerclements</label><br>
    </div>
  </details>

  <div id="assautResult" class="result-display">
    Appuie sur la roue ğŸ¡
  </div>

  <!-- Logo club discret -->
  <img src="logo-club.png" class="club-logo" alt="Logo club">
</div>
</div>
 <script>
const techniques = {
  1: { Atemi: "Uraken uchi", ClÃ©: "Kote gaeshi", Projection: "O soto gari" },
  2: { Atemi: "Mae hiza geri", ClÃ©: "Waki gatame", Projection: "TaÃ¯ otoshi" },
  3: { Atemi: "Yoko empi", ClÃ©: "Juji ude gatame", Projection: "Ippon seoi nage" },
  4: { Atemi: "Chudan mae geri", ClÃ©: "Yuki shigae", Projection: "Waki otoshi" },
  5: { Atemi: "Jodan shuto uchi", ClÃ©: "Hiji dori ura", Projection: "Uki waza" },
  6: { Atemi: "Chudan mawashi geri", ClÃ©: "Shiho nage", Projection: "HaraÃ¯ goshi" },
  7: { Atemi: "Chudan kizami tsuki", ClÃ©: "Tembin", Projection: "Ushiro goshi" },
  8: { Atemi: "Yoko fumikomi", ClÃ©: "Hashi mawashi", Projection: "Kata hizaguruma" }
};

let assauts = [];
let lastResults = [];
let soundOn = true;

const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");
const spinBtn = document.getElementById("spinBtn");
const resultBox = document.getElementById("assautResult");
const soundToggle = document.getElementById("soundToggle");

fetch("assauts.json").then(r => r.json()).then(data => {
  assauts = data;
  drawWheel(assauts);
});

function getFilters() {
  return [...document.querySelectorAll(".filter:checked")].map(cb => cb.value);
}

function pickRandom(filtered) {
  let pick;
  let tries = 0;
  do {
    pick = filtered[Math.floor(Math.random() * filtered.length)];
    tries++;
  } while (lastResults.includes(pick.nom) && tries < 10);

  lastResults.push(pick.nom);
  if (lastResults.length > 5) lastResults.shift(); // mÃ©moire 5 derniers
  return pick;
}

function spin() {
  const filters = getFilters();
  const filtered = assauts.filter(a => filters.includes(a.type_attaque));
  if (!filtered.length) {
    resultBox.textContent = "Aucun assaut disponible ğŸ˜…";
    return;
  }

  const assaut = pickRandom(filtered);
  const techNum = Math.ceil(Math.random() * 8);
  const types = ["Atemi", "ClÃ©", "Projection"];
  const type = types[Math.floor(Math.random() * 3)];
  const techName = techniques[techNum][type];

  const text = `${assaut.type_attaque} â€“ ${assaut.nom} âœ Technique ${techNum} / ${type} : ${techName}`;
  resultBox.innerHTML = `
    <div>${assaut.type_attaque} â€“ ${assaut.nom}</div>
    <div>â¬‡ï¸</div>
    <div>Technique ${techNum} â€“ ${type}</div>
    <div>${techName}</div>
  `;

  if (soundOn) speak(text);
  animateWheel();
}

function speak(text) {
  const u = new SpeechSynthesisUtterance(text);
  u.lang = "fr-FR";
  speechSynthesis.speak(u);
}

function animateWheel() {
  canvas.style.transition = "transform 2s cubic-bezier(.17,.67,.2,1)";
  canvas.style.transform = `rotate(${720 + Math.random()*360}deg)`;
  setTimeout(() => canvas.style.transition = "", 2000);
}

function drawWheel(data) {
  const colors = ["#ff4d4d","#ff9f1c","#2ec4b6","#6a4c93","#ff006e","#00bbf9"];
  const slice = (Math.PI * 2) / data.length;

  data.forEach((a, i) => {
    ctx.beginPath();
    ctx.moveTo(160,160);
    ctx.arc(160,160,160,i*slice,(i+1)*slice);
    ctx.fillStyle = colors[i % colors.length];
    ctx.fill();
  });
}

spinBtn.addEventListener("click", spin);

soundToggle.addEventListener("click", () => {
  soundOn = !soundOn;
  soundToggle.textContent = soundOn ? "ğŸ”Š" : "ğŸ”‡";
});
</script>


